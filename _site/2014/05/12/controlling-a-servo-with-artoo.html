<!DOCTYPE html>
<html lang="en">

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Controlling a Servo with Artoo</title>
  <meta name="description" content="Now that I have some basic facial recognition working we need to be able to control the direction of the camera. The first step to do this is to get some wir...">

  <link rel="stylesheet" href="/assets/main.css">
  <link rel="canonical" href="http://localhost:4000/2014/05/12/controlling-a-servo-with-artoo.html">
  <link rel="alternate" type="application/rss+xml" title="Geek-O-System" href="/feed.xml">
  
  
</head>


  <body>

    <header class="site-header" role="banner">

  <div class="wrapper">

    <a class="site-title" href="/">Geek-O-System</a>

    <nav class="site-nav">
      <span class="menu-icon">
        <svg viewBox="0 0 18 15" width="18px" height="15px">
          <path fill="#424242" d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.031C17.335,0,18,0.665,18,1.484L18,1.484z"/>
          <path fill="#424242" d="M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0c0-0.82,0.665-1.484,1.484-1.484 h15.031C17.335,6.031,18,6.696,18,7.516L18,7.516z"/>
          <path fill="#424242" d="M18,13.516C18,14.335,17.335,15,16.516,15H1.484C0.665,15,0,14.335,0,13.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.031C17.335,12.031,18,12.696,18,13.516L18,13.516z"/>
        </svg>
      </span>

      <div class="trigger">
        
          
          <a class="page-link" href="/about/">About</a>
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
      </div>
    </nav>

  </div>

</header>


    <main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title" itemprop="name headline">Controlling a Servo with Artoo</h1>
    <p class="post-meta"><time datetime="2014-05-12T21:51:15-06:00" itemprop="datePublished">May 12, 2014</time></p>
  </header>

  <div class="post-content" itemprop="articleBody">
    <p>Now that I have <a href="/blog/2014/04/25/facial-recognition-with-spyglass/">some basic facial recognition</a> working we need to be able to control the direction of the camera. The first step to do this is to get some wires connected from my laptop to a servo and send signals that control the motion of the servo.</p>

<h1 id="ingredients">Ingredients</h1>

<p><a href="http://artoo.io/documentation/drivers/servo/">Artoo.io</a> has a really simple interface for handling gpio like servos. In my case I used a <a href="http://digistump.com/products/1">digispark</a> to get access to some gpio pins that my laptop can control. Eventually I will use the <a href="http://beagleboard.org/Products/BeagleBone+Black">Beagle Bone Black</a> to control the servos, but the digispark gives me an easy way to test this out for just $9.</p>

<!--more-->

<h1 id="preparation">Preparation</h1>

<p>First I had to solder the headers to the digispark when it arrived. This always stresses me out because I am not very good at soldering and I worry about getting the embedded components too hot and frying the chip before I even use it. I really wish companies would offer an option to buy the hardware pre-soldered for an extra couple of dollars. An hour later it was soldered and didn’t look broken.</p>

<p>According to <a href="http://artoo.io/documentation/platforms/digispark/#HowToConnect">the artoo docs</a> we need to run two commands in order to get our connection to the digispark working. First we need to run a command that uploads a new firmware to the digispark. Let’s give it a whirl:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ artoo littlewire upload
         run  /Users/michael/.rvm/gems/ruby-2.1.0/.artoo/commands/littlewireLoader_v13 from "."
/Users/michael/.rvm/gems/ruby-2.1.0/.artoo/commands/littlewireLoader_v13: /Users/michael/.rvm/gems/ruby-2.1.0/.artoo/commands/littlewireLoader_v13: cannot execute binary file
</code></pre>
</div>

<p>Well that didn’t work. Let’s at least try to scan the usb devices to figure out the vendor and product ID that we need in to configure out artoo code.</p>

<div class="highlighter-rouge"><pre class="highlight"><code>$ artoo scan usb
OS not yet supported...
</code></pre>
</div>

<p>At this point you may be feeling like a sad panda, but there is always another way. I booted my laptop to ubuntu from a live  USB drive and tried installing the artoo gem again. I don’t know anyone from the <a href="http://hybridgroup.com/">Hybrid Group</a>, but I heard <a href="https://twitter.com/deadprogram">Ron Evans</a> on the <a href="http://rubyrogues.com/">Ruby Rogues</a> and he sounded like the kind of person that runs a linux distro so I was hoping that the gems would run more smoothly on ubuntu.</p>

<p>Sure enough once ruby was running and the gems were installed the two commands ran fine and I was read to test.</p>

<h1 id="the-dish">The Dish</h1>

<p>Now we are ready to write some code that changes the position of the servo. This turns out to be trivial. I used a couple of standard bread-board type wires to connect the servo’s ground, 5v and signal wires to the ground, 5v and pin1 pins on the digispark and fired up this code (this code runs both on Ubuntu and OSX).</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="nb">require</span> <span class="s1">'artoo'</span>
<span class="n">connection</span> <span class="ss">:digispark</span><span class="p">,</span> <span class="ss">:adaptor</span> <span class="o">=&gt;</span> <span class="ss">:littlewire</span><span class="p">,</span> <span class="ss">:vendor</span> <span class="o">=&gt;</span> <span class="mh">0x1781</span><span class="p">,</span> <span class="ss">:product</span> <span class="o">=&gt;</span> <span class="mh">0x0c9f</span>
<span class="n">device</span> <span class="ss">:board</span><span class="p">,</span> <span class="ss">:driver</span> <span class="o">=&gt;</span> <span class="ss">:device_info</span>
<span class="n">device</span> <span class="ss">:servo</span><span class="p">,</span> <span class="ss">:driver</span> <span class="o">=&gt;</span> <span class="ss">:servo</span><span class="p">,</span> <span class="ss">:pin</span> <span class="o">=&gt;</span> <span class="mi">1</span><span class="p">,</span> <span class="ss">:range</span> <span class="o">=&gt;</span> <span class="p">{</span><span class="ss">:min</span> <span class="o">=&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="ss">:max</span> <span class="o">=&gt;</span> <span class="mi">180</span><span class="p">}</span> <span class="c1"># pin must be a PWM pin</span>

<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">work</span> <span class="k">do</span>
  <span class="nb">puts</span> <span class="s2">"Firmware name: </span><span class="si">#{</span><span class="n">board</span><span class="p">.</span><span class="nf">firmware_name</span><span class="si">}</span><span class="s2">"</span>
  <span class="nb">puts</span> <span class="s2">"Firmata version: </span><span class="si">#{</span><span class="n">board</span><span class="p">.</span><span class="nf">version</span><span class="si">}</span><span class="s2">"</span>

  <span class="n">every</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">do</span>
    <span class="n">servo</span><span class="p">.</span><span class="nf">move</span><span class="p">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">180</span><span class="p">)</span>
    <span class="nb">puts</span> <span class="s2">"Current position: </span><span class="si">#{</span><span class="n">servo</span><span class="p">.</span><span class="nf">current_angle</span><span class="si">}</span><span class="s2">"</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
  <span class="k">end</span>
<span class="k">end</span>
</code></pre>
</div>

<p>And this is what happened!</p>

<iframe width="640" height="360" src="//www.youtube.com/embed/ISK5bVShs2w" frameborder="0" allowfullscreen=""></iframe>

<h2 id="friendly-bot-milestones"><a href="/blog/2014/04/23/planning-friendly-bot">Friendly Bot</a> Milestones</h2>

<ol>
  <li><del>Write some code that can detect a face in an image</del></li>
  <li><del>Write some artoo code that can control a servo</del></li>
  <li>Make a webcam mount with servos for pan and tilt</li>
  <li>Write some artoo code that controls the roomba</li>
  <li>Load code onto the Beagle Bone Black that controls the roomba and servos</li>
  <li>Load code onto the Beagle Bone Black that can detect faces seen by the webcam</li>
  <li>Write some glue code on the Beagle Bone Black that turns the roomba and servos to keep a face in the center of the image</li>
  <li>Make the roomba wander until it finds a face to follow (first time we can use the title Friendly Bot)</li>
  <li>Make friendly bot play the “curious” beeps when it finds a face</li>
  <li>Make Friendly Bot recognize family members and do “happy” or “skeptical” beeps</li>
</ol>

  </div>

  
</article>

      </div>
    </main>

    <footer class="site-footer">

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <h3>tags</h3>
        <div id="tag-cloud">
          <a href="/tag/apprenticeship.html" class="set-1">apprenticeship</a> <a href="/tag/artoo.html" class="set-1">artoo</a> <a href="/tag/aws.html" class="set-1">aws</a> <a href="/tag/beagleboneblack.html" class="set-1">beagleboneblack</a> <a href="/tag/development.html" class="set-1">development</a> <a href="/tag/digispark.html" class="set-1">digispark</a> <a href="/tag/friendly-bot.html" class="set-1">friendly-bot</a> <a href="/tag/hiring.html" class="set-1">hiring</a> <a href="/tag/interviewing.html" class="set-1">interviewing</a> <a href="/tag/maglev.html" class="set-2">maglev</a> <a href="/tag/mentoring.html" class="set-1">mentoring</a> <a href="/tag/opencv.html" class="set-1">opencv</a> <a href="/tag/programming.html" class="set-1">programming</a> <a href="/tag/puma.html" class="set-1">puma</a> <a href="/tag/robotics.html" class="set-1">robotics</a> <a href="/tag/ruby.html" class="set-5">ruby</a> <a href="/tag/spyglass.html" class="set-1">spyglass</a> <a href="/tag/tab-separated.html" class="set-1">tab-separated</a>
        </div>
      </div>

      <div class="footer-col footer-col-2">
        <ul class="contact-list">
          <li>
            
              Geek-O-System
            
            </li>
            
            <li><a href="mailto:michael@riesd.com">michael@riesd.com</a></li>
            
        </ul>
        <ul class="social-media-list">
          
          <li>
            <a href="https://github.com/mmmries"><span class="icon icon--github"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M7.999,0.431c-4.285,0-7.76,3.474-7.76,7.761 c0,3.428,2.223,6.337,5.307,7.363c0.388,0.071,0.53-0.168,0.53-0.374c0-0.184-0.007-0.672-0.01-1.32 c-2.159,0.469-2.614-1.04-2.614-1.04c-0.353-0.896-0.862-1.135-0.862-1.135c-0.705-0.481,0.053-0.472,0.053-0.472 c0.779,0.055,1.189,0.8,1.189,0.8c0.692,1.186,1.816,0.843,2.258,0.645c0.071-0.502,0.271-0.843,0.493-1.037 C4.86,11.425,3.049,10.76,3.049,7.786c0-0.847,0.302-1.54,0.799-2.082C3.768,5.507,3.501,4.718,3.924,3.65 c0,0,0.652-0.209,2.134,0.796C6.677,4.273,7.34,4.187,8,4.184c0.659,0.003,1.323,0.089,1.943,0.261 c1.482-1.004,2.132-0.796,2.132-0.796c0.423,1.068,0.157,1.857,0.077,2.054c0.497,0.542,0.798,1.235,0.798,2.082 c0,2.981-1.814,3.637-3.543,3.829c0.279,0.24,0.527,0.713,0.527,1.437c0,1.037-0.01,1.874-0.01,2.129 c0,0.208,0.14,0.449,0.534,0.373c3.081-1.028,5.302-3.935,5.302-7.362C15.76,3.906,12.285,0.431,7.999,0.431z"/></svg>
</span><span class="username">mmmries</span></a>

          </li>
          

          
          <li>
            <a href="https://twitter.com/mmmries"><span class="icon icon--twitter"><svg viewBox="0 0 16 16" width="16px" height="16px"><path fill="#828282" d="M15.969,3.058c-0.586,0.26-1.217,0.436-1.878,0.515c0.675-0.405,1.194-1.045,1.438-1.809c-0.632,0.375-1.332,0.647-2.076,0.793c-0.596-0.636-1.446-1.033-2.387-1.033c-1.806,0-3.27,1.464-3.27,3.27 c0,0.256,0.029,0.506,0.085,0.745C5.163,5.404,2.753,4.102,1.14,2.124C0.859,2.607,0.698,3.168,0.698,3.767 c0,1.134,0.577,2.135,1.455,2.722C1.616,6.472,1.112,6.325,0.671,6.08c0,0.014,0,0.027,0,0.041c0,1.584,1.127,2.906,2.623,3.206 C3.02,9.402,2.731,9.442,2.433,9.442c-0.211,0-0.416-0.021-0.615-0.059c0.416,1.299,1.624,2.245,3.055,2.271 c-1.119,0.877-2.529,1.4-4.061,1.4c-0.264,0-0.524-0.015-0.78-0.046c1.447,0.928,3.166,1.469,5.013,1.469 c6.015,0,9.304-4.983,9.304-9.304c0-0.142-0.003-0.283-0.009-0.423C14.976,4.29,15.531,3.714,15.969,3.058z"/></svg>
</span><span class="username">mmmries</span></a>

          </li>
          
        </ul>
      </div>

      <div class="footer-col footer-col-3">
        <a href="http://showoff.riesd.com/">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <style>
              @-webkit-keyframes spin {
                0% { -webkit-transform: rotate(0deg); }
                100% { -webkit-transform: rotate(360deg); }
              }
              .pupil {
                -webkit-transform-origin: 100% 120%;
                -webkit-animation: spin 1s cubic-bezier(1,0,0.5,1) 0s infinite;
              }
            </style>
            <rect fill="lightgreen" height="100" width="100" x="0" y="0"></rect>
            <circle cx="50" cy="130" r="80"></circle>
            <circle cx="50" cy="130" fill="grey" r="60"></circle>
            <g>
              <circle cx="22" cy="22" r="15"></circle>
              <circle cx="22" cy="22" fill="grey" r="9"></circle>
            </g>
            <g transform="translate(55,0)">
              <circle cx="22" cy="22" r="15"></circle>
              <circle cx="22" cy="22" fill="grey" r="9"></circle>
            </g>
            <polygon fill="black" points="5.00000000000000000000e+01 9.17000000000000028422e+01 7.73650324319193885003e+01 8.03650324319193885003e+01 8.87000000000000028422e+01 5.30000000000000000000e+01 7.73650324319193885003e+01 2.56349675680806114997e+01 5.00000000000000071054e+01 1.42999999999999971578e+01 2.26349675680806114997e+01 2.56349675680806043943e+01 1.12999999999999971578e+01 5.29999999999999928946e+01 2.26349675680806043943e+01 8.03650324319193885003e+01"></polygon>
            <polygon fill="lightgrey" points="5.00000000000000000000e+01 9.00000000000000000000e+01 7.82842712474619020213e+01 7.82842712474619020213e+01 9.00000000000000000000e+01 5.00000000000000000000e+01 7.82842712474619020213e+01 2.17157287525381015314e+01 5.00000000000000071054e+01 1.00000000000000000000e+01 2.17157287525381015314e+01 2.17157287525380908733e+01 1.00000000000000000000e+01 4.99999999999999928946e+01 2.17157287525380908733e+01 7.82842712474619020213e+01"></polygon>
            <g>
              <circle cx="35" cy="40" r="10"></circle>
              <circle cx="35" cy="40" fill="white" r="4"></circle>
              <circle class="pupil" cx="33" cy="38" r="2"></circle>
            </g>
            <g transform="translate(30,0)">
              <circle cx="35" cy="40" r="10"></circle>
              <circle cx="35" cy="40" fill="white" r="4"></circle>
              <circle class="pupil" cx="33" cy="38" r="2"></circle>
            </g>
            <polygon points="5.00000000000000000000e+01 6.60000000000000000000e+01 5.77942286340599480354e+01 5.25000000000000000000e+01 4.22057713659400519646e+01 5.25000000000000000000e+01"></polygon>
            <rect fill="black" height="2" transform="rotate(170, 50,71)" width="20" x="38" y="70"></rect>
            <rect fill="black" height="1" width="20" x="25" y="28"></rect>
            <rect fill="black" height="1" transform="rotate(195, 66,28)" width="20" x="55" y="28"></rect>
          </svg>
        </a>
      </div>
    </div>

  </div>

</footer>




  </body>

</html>
